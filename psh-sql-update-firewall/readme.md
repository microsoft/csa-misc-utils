My ISP has kept my home IP pretty stable until it reset it 3 times in the last month. I'd already written a script to check and update my S2S VPN gateway IP, but I kept getting knocked out of connections to Azure SQL. So I wrote this script and added a call to it from my other scheduled job. It gets the public IP from wherever you're running it, then uses a service principal that has rights to SQL servers - in one or more subscriptions in the same tenant - spins through each subscription, finds all SQL Servers, gets all firewall rules, checks to see if a matching rule exists and updates or creates it with the new IP address. Peachy!
